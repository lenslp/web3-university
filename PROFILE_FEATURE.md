# ä¸ªäººä¸­å¿ƒåŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°
ä¸ªäººä¸­å¿ƒé¡µé¢å·²å®Œå–„ï¼Œç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹ä¸ªäººä¿¡æ¯ï¼Œä¿®æ”¹æ—¶éœ€è¦ä½¿ç”¨é’±åŒ…ç­¾åéªŒè¯ï¼Œä¿¡æ¯ä¿å­˜åœ¨ PostgreSQL æ•°æ®åº“ä¸­ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. æŸ¥çœ‹ä¸ªäººèµ„æ–™
- è‡ªåŠ¨ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯
- æ˜¾ç¤ºé’±åŒ…åœ°å€ã€åŠ å…¥æ—¥æœŸã€ç»Ÿè®¡æ•°æ®å’Œæˆå°±
- æœªè¿æ¥é’±åŒ…æ—¶æç¤ºç”¨æˆ·è¿æ¥

### 2. ä¿®æ”¹ä¸ªäººèµ„æ–™
ç¼–è¾‘ä»¥ä¸‹å­—æ®µï¼š
- **åå­—** - æœ€å¤š 120 ä¸ªå­—ç¬¦
- **é‚®ç®±** - æœ€å¤š 200 ä¸ªå­—ç¬¦
- **ä¸ªäººç®€ä»‹** - æ–‡æœ¬åŒºåŸŸ
- **å¤´åƒ** - 6 ä¸ªè¡¨æƒ…å¯é€‰ï¼šğŸ§‘, ğŸ‘¨â€ğŸ’¼, ğŸ‘©â€ğŸ’¼, ğŸ§‘â€ğŸ“, ğŸ§‘â€ğŸ’», ğŸ¤“

### 3. ç­¾åéªŒè¯
- ç”¨æˆ·ç‚¹å‡»"ä¿å­˜"æŒ‰é’®åï¼Œè°ƒç”¨ wagmi çš„ `signMessageAsync` è¿›è¡Œé’±åŒ…ç­¾å
- å‰ç«¯ä½¿ç”¨ viem ç­¾åï¼Œåç«¯ä½¿ç”¨ viem çš„ `recoverMessageAddress` éªŒè¯ç­¾å
- ç­¾åé€šè¿‡åæ‰ä¼šæ›´æ–°æ•°æ®åº“

## æŠ€æœ¯æ ˆ

### Frontend
- **æ¡†æ¶**: Next.js 15 (React 19)
- **é’±åŒ…é›†æˆ**: wagmi 2.x + viem 2.x + RainbowKit
- **çŠ¶æ€ç®¡ç†**: React hooks
- **UI**: Tailwind CSS

### Backend
- **æ¡†æ¶**: NestJS
- **æ•°æ®åº“**: PostgreSQL + Prisma ORM
- **ç­¾åéªŒè¯**: viem çš„ `recoverMessageAddress`
- **éªŒè¯**: class-validator

## API ç«¯ç‚¹

### GET /profile?address=0x...
è·å–ç”¨æˆ·ä¸ªäººèµ„æ–™
- **è¯·æ±‚**: æŸ¥è¯¢å‚æ•° `address`
- **å“åº”**: Profile å¯¹è±¡
  ```json
  {
    "walletAddress": "0x...",
    "name": "ç”¨æˆ·å",
    "email": "é‚®ç®±@example.com",
    "bio": "ä¸ªäººç®€ä»‹",
    "avatar": "ğŸ§‘",
    "joinDate": "2024-12-22",
    "totalCourses": 0,
    "totalStudying": 0,
    "totalSpent": 0,
    "rating": 0,
    "achievements": []
  }
  ```

### POST /profile
æ›´æ–°ç”¨æˆ·ä¸ªäººèµ„æ–™ï¼ˆéœ€è¦ç­¾åéªŒè¯ï¼‰
- **è¯·æ±‚ä½“**:
  ```json
  {
    "address": "0x...",
    "message": "Update profile for 0x...",
    "signature": "0x...",
    "profile": {
      "name": "æ–°ç”¨æˆ·å",
      "email": "æ–°é‚®ç®±@example.com",
      "bio": "æ–°ç®€ä»‹",
      "avatar": "ğŸ‘¨â€ğŸ’¼"
    }
  }
  ```
- **éªŒè¯æµç¨‹**:
  1. ä½¿ç”¨ viem çš„ `recoverMessageAddress` æ¢å¤ç­¾ååœ°å€
  2. å¯¹æ¯”æ¢å¤åœ°å€ä¸è¯·æ±‚åœ°å€ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
  3. åœ°å€åŒ¹é…æ—¶ä¿å­˜åˆ°æ•°æ®åº“ï¼Œå¦åˆ™è¿”å› 401 Unauthorized

## æ•°æ®åº“ Schema

```prisma
model Profile {
  walletAddress String   @id @db.VarChar(80)
  name          String   @default("") @db.VarChar(120)
  email         String   @default("") @db.VarChar(200)
  bio           String   @default("") @db.Text
  avatar        String   @default("ğŸ§‘") @db.VarChar(16)
  joinDate      String   @default("") @db.VarChar(32)
  totalCourses  Int      @default(0)
  totalStudying Int      @default(0)
  totalSpent    Int      @default(0)
  rating        Float    @default(0)
  achievements  String[] @default([])

  @@map("profiles")
}
```

## ä½¿ç”¨æµç¨‹

### ç”¨æˆ·æŸ¥çœ‹èµ„æ–™
1. æ‰“å¼€ `/student/profile` é¡µé¢
2. è¿æ¥é’±åŒ…ï¼ˆå¦‚æœªè¿æ¥ï¼‰
3. é¡µé¢è‡ªåŠ¨åŠ è½½ç”¨æˆ·ä¿¡æ¯
4. é¡µé¢é¦–æ¬¡åŠ è½½æ—¶ä¼šè°ƒç”¨ `GET /profile?address=0x...`

### ç”¨æˆ·ä¿®æ”¹èµ„æ–™
1. ç‚¹å‡»"ç¼–è¾‘ä¸ªäººèµ„æ–™"æŒ‰é’®
2. åœ¨è¡¨å•ä¸­ä¿®æ”¹ä¿¡æ¯ï¼š
   - ä¿®æ”¹æ–‡æœ¬å­—æ®µï¼ˆåå­—ã€é‚®ç®±ã€ç®€ä»‹ï¼‰
   - æˆ–é€‰æ‹©æ–°å¤´åƒ
3. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
4. å‰ç«¯è°ƒç”¨é’±åŒ…ç­¾åï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰
5. åç«¯éªŒè¯ç­¾åå¹¶ä¿å­˜åˆ°æ•°æ®åº“
6. é¡µé¢æ›´æ–°æ˜¾ç¤ºæ–°ä¿¡æ¯
7. æ˜¾ç¤º"Profile updated successfully!" æˆåŠŸæç¤º

### é”™è¯¯å¤„ç†
- **é’±åŒ…æœªè¿æ¥**: æ˜¾ç¤º"è¿æ¥é’±åŒ…"æç¤º
- **ç­¾åå¤±è´¥**: æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼Œä¸ä¸Šä¼ æ•°æ®
- **ç­¾åéªŒè¯å¤±è´¥**: è¿”å› 401ï¼Œæ˜¾ç¤º"Signature verification failed"
- **æ•°æ®åº“é”™è¯¯**: è¿”å›é”™è¯¯æ¶ˆæ¯

## ç¯å¢ƒé…ç½®

### Frontend (.env.local)
```
NEXT_PUBLIC_API_URL=http://localhost:3001
```

### Backend (.env)
```
DATABASE_URL=postgresql://user:password@localhost:5432/web3_university
PORT=3001
```

## å¯åŠ¨æ­¥éª¤

1. **å¯åŠ¨åç«¯**
   ```bash
   cd Backend
   pnpm install
   pnpm db:push  # åŒæ­¥ Prisma schema
   pnpm start
   ```

2. **å¯åŠ¨å‰ç«¯**
   ```bash
   cd Frontend
   pnpm install
   pnpm dev
   ```

3. **è®¿é—®ä¸ªäººä¸­å¿ƒ**
   - æ‰“å¼€ http://localhost:3000/student/profile
   - è¿æ¥é’±åŒ…
   - æŸ¥çœ‹å’Œç¼–è¾‘ä¸ªäººä¿¡æ¯

## æ³¨æ„äº‹é¡¹

1. **ç­¾åéªŒè¯**: ç­¾åé‡‡ç”¨ EIP-191 æ ‡å‡†ï¼Œç¡®ä¿åªæœ‰é’±åŒ…æ‰€æœ‰è€…èƒ½ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯
2. **åœ°å€è§„èŒƒåŒ–**: æ‰€æœ‰åœ°å€éƒ½è½¬ä¸ºå°å†™å­˜å‚¨å’Œæ¯”å¯¹
3. **æ•°æ®åˆå§‹åŒ–**: é¦–æ¬¡è®¿é—®ç”¨æˆ·ä¼šè‡ªåŠ¨åˆ›å»ºè®°å½•ï¼ŒåŒ…å«é»˜è®¤å€¼
4. **å¤´åƒé€‰æ‹©**: æ”¯æŒä»»æ„ Unicode è¡¨æƒ…ç¬¦å·ï¼Œä½† UI æä¾›äº† 6 ä¸ªé¢„è®¾é€‰é¡¹

## æ”¹è¿›æ–¹å‘

- [ ] æ·»åŠ æ›´å¤šç»Ÿè®¡å­—æ®µï¼ˆå­¦ä¹ æ—¶é•¿ã€å®Œæˆåº¦ç­‰ï¼‰
- [ ] å®ç°å¤´åƒä¸Šä¼ åˆ°äº‘å­˜å‚¨
- [ ] æ·»åŠ ä¸ªäººæˆå°±ç³»ç»Ÿå’Œè‡ªåŠ¨æ›´æ–°é€»è¾‘
- [ ] å®ç°ç”¨æˆ·æ’è¡Œæ¦œåŠŸèƒ½
- [ ] æ·»åŠ ä¸ªäººèµ„æ–™å®Œæ•´åº¦æç¤º
